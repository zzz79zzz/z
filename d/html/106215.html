<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator IV total parenteral nutrition children</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1em;
            font-family: Arial, sans-serif;
            font-size: 18px;
        }
        #healthForm {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 1em;
        }
        #healthForm > div {
            flex: 0 0 20%;
            margin: 0.5em;
        }
        select {
            font-size: 18px;
        }
        input[type="button"] {
            padding: 1em;
            font-size: 1.2em;
            background-color: crimson;
        }
        table {
            margin: auto;
        }
        @media (max-width: 600px) {
            #healthForm > div {
                flex: 1 0 100%;
            }
        }
    </style>
</head>
<body>
    <h2>Calculator IV total parenteral nutrition in children</h2>
    <form id="healthForm">
        <table>
            <tr>
                <td>Cân nặng (Kg, VD: 7,5 Kg):</td>
                <td><input type="number" id="InW" name="InW" step="0.1" required></td>
            </tr>
            <tr>
                <td>Tuổi (năm):</td>
                <td><input type="number" id="InY" name="InY"></td>
            </tr>
            <tr>
                <td>Dịch nhập (Kháng sinh, vận mạch,...) (ml):</td>
                <td><input type="number" id="Vid" name="Vid" required></td>
            </tr>
            <tr>
                <td>Dịch xuất (Hô hấp, da, nước tiểu, phân,...) (ml):</td>
                <td><input type="number" id="Vexp" name="Vexp" required></td>
            </tr>
            <tr>
                <td>Loại đường truyền</td>
                <td>
                    <select id="vein" name="vein">
                        <option value="PVC">Đường truyền tĩnh mạch ngoại biên</option>
                        <option value="CVC">Đường truyền tĩnh mạch trung tâm</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Năng lượng trong ngày:</td>
                <td>
                    <select id="nltn" name="nltn">
                        <option value="0.6">0.6 nhu cầu cơ bản</option>
                        <option value="0.8">0.8 nhu cầu cơ bản</option>
                        <option value="1">Bằng nhu cầu cơ bản</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Nhu cầu Protein:</td>
                <td>
                    <select id="ncprotein" name="ncprotein">
                        <option value="1g">1g/Kg/ngày</option>
                        <option value="2g">2g/Kg/ngày</option>
                        <option value="3g">3g/Kg/ngày</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Chế phẩm Protein:</td>
                <td>
                    <select id="protein" name="protein">
                        <option value="Vaminolac 6,5%">Vaminolac 6,5%</option>
                        <option value="Vaminolac 10%">Aminoplasma 10%</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Nhu cầu Lipid:</td>
                <td>
                    <select id="nclipid" name="nclipid">
                        <option value="0g">Không nuôi Lipid</option>
                        <option value="1g">1g/Kg/ngày</option>
                        <option value="2g">2g/Kg/ngày</option>
                        <option value="3g">3g/Kg/ngày</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Chế phẩm Lipid:</td>
                <td>
                    <select id="lipid" name="lipid">
                        <option value="Lipofudin 10%">Lipofudin 10%</option>
                        <option value="Lipofudin 20%">Lipofudin 20%</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Sử dụng NaCl:</td>
                <td>
                    <select id="nacl" name="nacl">
                        <option value="yes">Có</option>
                        <option value="no">Không</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Sử dụng KCl:</td>
                <td>
                    <select id="kcl" name="kcl">
                        <option value="yes">Có</option>
                        <option value="no">Không</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Chế phẩm Canxi:</td>
                <td>
                    <select id="calcium" name="calcium">
                        <option value="Growbon 10%">Growbon 10%</option>
                        <option value="CaCl2 10%">CaCl2 10%</option>
                        <option value="none">Không sử dụng</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td></td>
                <td><input type="button" value="Calculate" onclick="calculate()"></td>
            </tr>
        </table>
    </form>
    <table id="resultTable" border="1">
        <tr>
            <th>Đường truyền</th>
            <th>Tên chất</th>
            <th>Thể tích</th>
            <th>Tốc độ truyền</th>
        </tr>
        <!-- Table rows will be added here -->
    </table>
    <script>
        function calculate() {
            // Get input values
            var InW = parseFloat(document.getElementById('InW').value);
            var InY = parseInt(document.getElementById('InY').value);
            var Vid = parseInt(document.getElementById('Vid').value);
            var Vexp = document.getElementById('Vexp').value;
            // Check if InW and Vid are not empty
            if (InW === "" || Vid === "") {
                alert("Vui lòng nhập đầy đủ cân nặng và dịch đã có trong ngày.");
                return;
            }
            // Convert input values to numbers
            InW = parseFloat(InW);
            Vid = parseFloat(Vid);
            Vexp = parseFloat(Vexp);
            var lipid = document.getElementById('lipid').value;
            var protein = document.getElementById('protein').value;
            var calcium = document.getElementById('calcium').value;
            var nltn = document.getElementById('nltn').value;
            var nclipid = document.getElementById('nclipid').value;
            var ncprotein = document.getElementById('ncprotein').value;
            var nacl = document.getElementById('nacl').value;
            var kcl = document.getElementById('kcl').value;
            var vein = document.getElementById('vein').value;
            // Perform calculations
            var nclipid, vein ,V, V2, K, K1 , LP1, VLP1, VtruyenLP, Vtruyen2, Vexp, Prt1, VPrt1, Vnacl10, Vkcl10, Vca, Vglu1, Kglu1, mglu1, Vglu10, Vglu30, ALTT1, Cglu1, loaivein;
            
            if (InW <= 10) {
                V = Vexp + InW * 100;
            } else if (InW > 10 && InW <= 20) {
                V = Vexp + 1000 + (InW - 10) * 50;
            } else {
                V = Vexp + 1500 + (InW - 20) * 20;
            }
        
            if  (nltn == "0.6"){
                K1 = 0.6 * V;
            } else if (nltn == "0.8"){
                K1 = 0.8 * V;
            } else {
                K1 = V;
            }
            if  (nclipid == "0g"){
                LP1 = 0;
            } else if (nclipid == "1g"){
                LP1 = InW;
            } else if (nclipid == "2g"){
                LP1 = 2 * InW;
            } else {
                LP1 = 3 * InW;
            }
            if (lipid == "Lipofudin 10%") {
                VLP1 = LP1 / 0.1;
            } else {
                VLP1 = LP1 / 0.2;
            }
            VtruyenLP = VLP1 / 12;
            if (ncprotein == "1g"){
                Prt1 = InW;
            } else if (ncprotein == "2g"){
                Prt1 = 2 * InW;
            } else {
                Prt1 = 3 * InW;
            }
            if (protein == "Vaminolac 6,5%") {
                VPrt1 = Prt1 / 0.065;
            } else {
                VPrt1 = Prt1 / 0.1;
            }
            if (nacl == "no") {
                Vnacl10 = 0;
            } else {
                Vnacl10 = (InW * 3) / 1.7;
            }
            if (kcl == "no") {
                Vkcl10 = 0;
            } else {
                Vkcl10 = (InW * 2) / 1.34;
            }
            if (calcium == "none") {
                Vca = 0;
            }   else if (calcium == "Growbon 10%") {
                Vca = InW / 0.46;
            }   else {
                Vca = InW / 1.51;
            }
            V2 = V - Vid - VLP1;
            Vglu1 = V - Vid - VLP1 - VPrt1 - Vnacl10 - Vkcl10 - Vca;
            Kglu1 = K1 - (LP1 * 9) - (Prt1 * 4);
            mglu1 = Kglu1/4;
            Vglu30 = (mglu1 - 0.1 * Vglu1) / 0.2;
            Vglu10 = Vglu1 - Vglu30;
            ALTT1 = (mglu1 / V2 * 100) * 50 + (Prt1 / V2 * 100) * 100 + 2 * (InW * 6 * 1000 / V2);
            Cglu1 = (mglu1 / V2) * 100;
            Vtruyenglu = ((mglu1 * 1000) / InW ) / (24 * 60);
            Vtruyen2 = V2 / 24;
            if (Cglu1 <= 0.125 && ALTT1 <= 900 && vein == "PVC") {
                loaivein = "Đường truyền ngoại biên";
            } else {
                loaivein = "Ưu tiên đường truyền trung tâm";
            }
                    // Check for negative values and update loaivein if necessary
            var values = [V, K1, LP1, VLP1, VtruyenLP, Prt1, VPrt1, Vnacl10, Vkcl10, Vca, V2, Vglu1, Kglu1, mglu1, Vglu30, Vglu10, ALTT1, Cglu1, Vtruyenglu, Vtruyen2];
            for (var i = 0; i < values.length; i++) {
                if (values[i] < 0) {
                    loaivein = "Thành phần không hợp lí";
                }
            }

            // Display results in table
            var table = document.getElementById('resultTable');
            // Clear previous results
            table.innerHTML = table.rows[0].innerHTML;
            // Add new rows with calculated values
            var row1 = table.insertRow(-1);
            row1.insertCell(0).innerHTML = "Đường truyền 1" ;
            row1.insertCell(1).innerHTML = lipid;
            row1.insertCell(2).innerHTML = Math.round(VLP1) + " ml";
            row1.insertCell(3).innerHTML = Math.round(VtruyenLP) + "ml/h";
            var row2 = table.insertRow(-1);
            row2.insertCell(0).innerHTML = "Đường truyền 2";
            row2.insertCell(1).innerHTML = "Tổng thể tích Vein 2";
            row2.insertCell(2).innerHTML = Math.round(V2) + " ml";
            row2.insertCell(3).innerHTML = Math.round(Vtruyen2) + "ml/h";
            var substances = ["Glucose 10%", "Glucose 30%", "NaCl 10%", "KCl 10%", calcium, protein];
            var values = [Vglu10, Vglu30, Vnacl10, Vkcl10, Vca, VPrt1];
            for (var i = 0; i < substances.length; i++) {
                var row = table.insertRow(-1);
                row.insertCell(0).innerHTML = "";
                row.insertCell(1).innerHTML = substances[i];
                row.insertCell(2).innerHTML = Math.round(values[i]) + " ml";
            }
            var row8 = table.insertRow(-1);
            row8.insertCell(0).innerHTML = "Loại đường truyền";
            row8.insertCell(1).innerHTML =  "<span style='color:red;'>" + loaivein + "</span>";
            row8.cells[1].colSpan = 3;            
            var row9 = table.insertRow(-1);
            row9.insertCell(0).innerHTML = "";
            row9.insertCell(1).innerHTML = "Nồng độ Glucose:";
            row9.insertCell(2).innerHTML = parseFloat(Cglu1.toFixed(1))+"%";
            row9.insertCell(3).innerHTML = Math.round(Vtruyenglu) + "mg/kg/Phút";
            var row10 = table.insertRow(-1);
            row10.insertCell(0).innerHTML = "";
            row10.insertCell(1).innerHTML = "Áp lực thẩm thấu";
            row10.insertCell(2).innerHTML = Math.round(ALTT1) + " mOsmol/L";

        }
        
    </script>
</body>
</html>
