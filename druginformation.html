<!DOCTYPE html>

<html lang="fa">
<meta content="text/html;charset=utf-8" http-equiv="content-type"/>
<head><title> UpToDate-2024 by Z</title>
  <link href="/d/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="/d/css/classy-nav.min.css" rel="stylesheet"/>
  <link href="/d/css/style.css" rel="stylesheet"/>
  <link href="/d/css/1.css" rel="stylesheet"/>
  <script language="javascript" type="text/javascript"></script>

</head>
<body>
  <section class="uptodate-area sticky" id="uptodate-area" style="z-index: 999; padding: 0px; margin-top: 0px;">
    <div class="container">
        <div class="newsletter">
            <div class="row">
                  <div class="col-md-2 col-2"></div>
                  <div class="col-md-2 col-2" style=" margin-top: 3%;margin-bottom: 3%;">
                    <a href="/index.html" title="">
                      <img id="Uptodate_image" style="width: 80px" src="/imgs/UpToDate.png">&nbsp;&nbsp;
                    </a>
                  </div>
                  <div class="col-md-3 col-3" style=" margin-bottom: 5%;">
                    <a href="/index.html" title="">
                      <img id="Uptodate_image" style="width: 200px" src="/imgs/uptodate-logo (1).png">
                    </a>
                  </div>
                  <div class="col-md-3 col-3" style="margin-left: 0;margin-top: 5%;">
                    <span class="countBubl ui-btn-corner-all" id="uptodate_version" style="font-size: 1.5vw;">Version May 2024 by Z</span>
                  </div>
                  
                  <div class="col-md-1 col-1"></div>
            </div>
        </div>
    </div>
</section>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<section class="newsletter-area" style="padding-bottom: 30px;">
  <div class="container">
    <div class="row">

    <div class="col-lg-8 col-12"> 
      <div class="newsletter">
        <form class="row" method="get" accept-charset="utf-8" id="searchForm" novalidate="novalidate">
          <div class="col-md-9" style="margin-top: 50px">
            <input class="form-control m4inb" name="title" type="text" placeholder="Input the name of drug" id="inputSearch">
          </div>
          <div class="col-md-3">
            <button onclick="findRelatedFiles(event)" type="submit" style="width:100%;margin-top: 50px" class="btn btn-primary">Search</button>
          </div>
        </form>
        
        <div id="results"></div>
        
        
        
        
      </div>
    </div>
    </div>
  </div>
</section>
<script type="text/javascript">

  // Hàm Jaro-Winkler
function jaroWinkler(a, b) {
  var m = 0;

  // Exit early if either are empty.
  if (a.length === 0 || b.length === 0) {
    return 0;
  }

  // Exit early if they're an exact match.
  if (a === b) {
    return 1;
  }

  var range = (Math.floor(Math.max(a.length, b.length) / 2)) - 1,
      aMatches = new Array(a.length),
      bMatches = new Array(b.length);

  for (var i = 0; i < a.length; i++) {
    var low = (i >= range) ? i - range : 0,
        high = (i + range <= (b.length - 1)) ? (i + range) : (b.length - 1);

    for (var j = low; j <= high; j++) {
      if (aMatches[i] !== true && bMatches[j] !== true && a[i] === b[j]) {
        ++m;
        aMatches[i] = bMatches[j] = true;
        break;
      }
    }
  }

  // Exit early if no matches were found.
  if (m === 0) {
    return 0;
  }

  // Count the transpositions.
  var k = n_trans = 0;

  for (var i = 0; i < a.length; i++) {
    if (aMatches[i] === true) {
      for (var j = k; j < b.length; j++) {
        if (bMatches[j] === true) {
          k = j + 1;
          break;
        }
      }

      if (a[i] !== b[j]) {
        ++n_trans;
      }
    }
  }

  var weight = (m / a.length + m / b.length + (m - (n_trans / 2)) / m) / 3,
      
      p = 0.5;
      l = 0;

  if (weight > 0.7) {
    while (a[l] === b[l] && l < 5) {
      ++l;
    }

    weight = weight + l * p * (1 - weight);
  }

  return weight;
}

// Hàm này sẽ được gọi khi người dùng nhập tiêu đề và nhấn enter
function findRelatedFiles(event) {
  event.preventDefault();
  var input = document.getElementById('inputSearch').value;

  fetch('/d/drug.json')
      .then(response => response.json())
      .then(jsonData => {
          var inputWords = input.split(' ');

          var relatedFiles = Object.keys(jsonData)
              .map(function(fileName) {
                  var titleWords = jsonData[fileName].split(' ');
                  var commonWordsCount = titleWords.filter(word => inputWords.includes(word)).length;
                  var similarity = jaroWinkler(jsonData[fileName], input);
                  return { fileName, score: commonWordsCount + similarity };
              })
              .filter(file => file.score > 0)
              .sort((a, b) => b.score - a.score)
              .slice(0, 10)  // Giới hạn kết quả chỉ cần trả về 25 câu trả lời tương đồng nhất
              .map(file => file.fileName);
          // Tạo và hiển thị danh sách các div
          var resultsDiv = document.getElementById('results');
          resultsDiv.innerHTML = '';
          relatedFiles.forEach(function(fileName) {
              var div = document.createElement('div');
              div.classList.add('selections'); // Thêm class CSS vào đây
              var link = document.createElement('a');
              link.href = '/d/drug information/' + fileName;
              link.textContent = jsonData[fileName];
              div.appendChild(link);
              resultsDiv.appendChild(div);
          });
      })
      .catch(error => console.error('Có lỗi xảy ra:', error));
}

</script>

</body>
</html>
