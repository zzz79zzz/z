<!DOCTYPE html>

<html>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="text/html; charset = utf-8" http-equiv="content-type"/>
<head>
  <title> UpToDate-2024 by Z</title>
  <link href="d/css/2.css" rel="stylesheet"/>

</head>
<body>
  <footer class="uptodate" id="uptodate-area" >
              <div class = "row">
                <div class="blank"></div>
                  <div class="uptodate1" >
                          <a href="/z/index.html">
                            <img id="uptodate-img1"  src="imgs/UpToDate.png">
                          </a>
                  </div>  
                    <div class="uptodate2" >
                          <a href="/z/index.html" >
                            <img id="uptodate-img2"  src="imgs/uptodate-logo (1).png">
                          </a>
                    </div>        
                      <div class="uptodate3" >
                        <p> May 2024 by Z</p> Drug information
                      </div>  
                <div class="blank"></div>
              </div>    
                 
  </footer>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<div></div>
<div  class = "search">
  <div class="row">
                  <div class="ipt"><input class="input" name="title" type="text" placeholder="Input the name of drug" id="inputSearch"></div>
                  <div class="btn"><button onclick="findRelatedFiles(event)" type="submit"  class="buttonsearch">Search</button></div>
  </div>
</div>
<div  id="results"></div>
<script type="text/javascript">

  // Hàm Jaro-Winkler
function jaroWinkler(a, b) {
  var m = 0;

  // Exit early if either are empty.
  if (a.length === 0 || b.length === 0) {
    return 0;
  }

  // Exit early if they're an exact match.
  if (a === b) {
    return 1;
  }

  var range = (Math.floor(Math.max(a.length, b.length) / 2)) - 1,
      aMatches = new Array(a.length),
      bMatches = new Array(b.length);

  for (var i = 0; i < a.length; i++) {
    var low = (i >= range) ? i - range : 0,
        high = (i + range <= (b.length - 1)) ? (i + range) : (b.length - 1);

    for (var j = low; j <= high; j++) {
      if (aMatches[i] !== true && bMatches[j] !== true && a[i] === b[j]) {
        ++m;
        aMatches[i] = bMatches[j] = true;
        break;
      }
    }
  }

  // Exit early if no matches were found.
  if (m === 0) {
    return 0;
  }

  // Count the transpositions.
  var k = n_trans = 0;

  for (var i = 0; i < a.length; i++) {
    if (aMatches[i] === true) {
      for (var j = k; j < b.length; j++) {
        if (bMatches[j] === true) {
          k = j + 1;
          break;
        }
      }

      if (a[i] !== b[j]) {
        ++n_trans;
      }
    }
  }

  var weight = (m / a.length + m / b.length + (m - (n_trans / 2)) / m) / 3,
      
      p = 0.5;
      l = 0;

  if (weight > 0.7) {
    while (a[l] === b[l] && l < 5) {
      ++l;
    }

    weight = weight + l * p * (1 - weight);
  }

  return weight;
}

// Hàm này sẽ được gọi khi người dùng nhập tiêu đề và nhấn enter
function findRelatedFiles(event) {
  event.preventDefault();
  var input = document.getElementById('inputSearch').value;
  // Chuyển inputSearch thành chữ thường và loại bỏ các ký tự không phải là chữ cái
      input = input.toLowerCase().replace(/[^a-z]/g, '');


  fetch('d/drug.json')
      .then(response => response.json())
      .then(jsonData => {
          var inputWords = input.split(' ');

          var relatedFiles = Object.keys(jsonData)
              .map(function(fileName) {
                  var titleWords = jsonData[fileName].split(' ');
                  var commonWordsCount = titleWords.filter(word => inputWords.includes(word)).length;
                  var similarity = jaroWinkler(jsonData[fileName], input);
                  return { fileName, score: commonWordsCount + similarity };
              })
              .filter(file => file.score > 0)
              .sort((a, b) => b.score - a.score)
              .slice(0, 10)  // Giới hạn kết quả chỉ cần trả về 25 câu trả lời tương đồng nhất
              .map(file => file.fileName);
          // Tạo và hiển thị danh sách các div
          var resultsDiv = document.getElementById('results');
          resultsDiv.innerHTML = '';
          relatedFiles.forEach(function(fileName) {
              var div = document.createElement('div');
              div.classList.add('selections'); // Thêm class CSS vào đây
              var link = document.createElement('a');
              link.href = '/z/d/drug information/' + fileName;
              link.textContent = jsonData[fileName];
              div.appendChild(link);
              resultsDiv.appendChild(div);
          });
      })
      .catch(error => console.error('Có lỗi xảy ra:', error));
}
document.getElementById('inputSearch').addEventListener('keypress', function(event) {
  if (event.key === 'Enter') {
    findRelatedFiles(event);
  }
});
</script>

</body>
</html>
